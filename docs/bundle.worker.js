(()=>{"use strict";function t(t){const e=[];for(;t>0;)e.push(255&t),t>>=8;return new Uint8Array(e.reverse())}function e(t,e){const r=new Uint8Array(e);for(let n=e-1;n>=0;n--)r[n]=255&t,t>>=8;return r}function r(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function n(t){const e=[],r=(t.length%8?new Array(9-t.length%8).join("0"):"")+t;for(let t=0;t<r.length;t+=8)e.push(parseInt(r.substr(t,8),2));return new Uint8Array(e)}function o(t){return{id:187,data:[{data:Math.round(t),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]}}function a(t,e){e||(e=[]);for(const r of t)"object"==typeof r&&r[Symbol.iterator]?a(r,e):e.push(r);return e}function i(o,s){const d=[];for(const a of o){if(!("id"in a)){d.push(a);continue}let o=a.data;"object"==typeof o&&(o=i(o,s)),"number"==typeof o&&(o="size"in a?e(o,a.size||0):n(o.toString(2))),"string"==typeof o&&(o=r(o));const c=o.size||o.byteLength||o.length,u=Math.ceil(Math.ceil(Math.log(c)/Math.log(2))/8),f=c.toString(2),h=new Array(7*u+7+1-f.length).join("0")+f,l=new Array(u).join("0")+"1"+h;d.push(t(a.id)),d.push(n(l)),d.push(o)}if(s){const t=a(d);return new Uint8Array(t)}return new Blob(d,{type:"video/webm"})}function s(t){let e=0;if(t.keyframe&&(e|=128),t.invisible&&(e|=8),t.lacing&&(e|=t.lacing<<1),t.discardable&&(e|=1),t.trackNum>127)throw new Error("TrackNumber > 127 not supported");return[128|t.trackNum,t.timecode>>8,255&t.timecode,e].map((t=>String.fromCharCode(t))).join("")+t.frame}function d(t,e){const r=function(t){const e=t[0].width,r=t[0].height;let n=t[0].duration;for(let o=1;o<t.length;o++){if(t[o].width!==e)throw new Error("Frame "+(o+1)+" has a different width");if(t[o].height!==r)throw new Error("Frame "+(o+1)+" has a different height");if(t[o].duration<0||t[o].duration>32767)throw new Error("Frame "+(o+1)+" has a weird duration (must be between 0 and 32767)");n+=t[o].duration}return{duration:n,width:e,height:r}}(t),n=function(t){var e;return[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(e=t.duration,[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map((t=>String.fromCharCode(t))).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]},{id:475249515,data:[]}]}]}(r),a=n[1],d=a.data[2];let c=0,u=0;for(;c<t.length;){const e=o(u);d.data.push(e);const r=[];let n=0;do{r.push(t[c]),n+=t[c].duration,c++}while(c<t.length&&n<3e4);let i=0;const f=r.map((t=>{const e=s({discardable:0,frame:t.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(i)});return i+=t.duration,{data:e,id:163}})),h={id:524531317,data:[{data:Math.round(u),id:231},...f]};a.data.push(h),u+=n}let f=0;for(let t=0;t<a.data.length;t++){t>=3&&(d.data[t-3].data[1].data[1].data=f);const r=i([a.data[t]],e);"undefined"!=typeof Blob&&r instanceof Blob&&(f+=r.size),r instanceof Uint8Array&&(f+=r.byteLength),2!==t&&(a.data[t]=r)}return i(n,e)}function c(t){const e=t.RIFF[0].WEBP[0],r=e.indexOf("¬ù*"),n=[];for(let t=0;t<4;t++)n[t]=e.charCodeAt(r+3+t);let o=n[1]<<8|n[0];const a=16383&o;return o=n[3]<<8|n[2],{width:a,height:16383&o,data:e,riff:t}}function u(t,e){return parseInt(t.substr(e,4).split("").map((t=>{const e=t.charCodeAt(0).toString(2);return new Array(8-e.length+1).join("0")+e})).reverse().join(""),2)}function f(t){let e=14;for(;e<t.length;){const r=t.substr(e,4);e+=4;const n=u(t,e);switch(e+=4,r){case"VP8 ":case"VP8L":return t.substr(e-4,4)+t.substr(e,n);default:e+=n}}throw new Error("VP8X format error: missing VP8/VP8L chunk.")}function h(t){let e=0;const r={};for(;e<t.length;){const n=t.substr(e,4);if(r[n]=r[n]||[],"RIFF"===n||"LIST"===n){const o=u(t,e+4),a=t.substr(e+4+4,o);e+=8+o,r[n].push(h(a))}else if("WEBP"===n){const o=t.substr(e+4,4);switch(o){case"VP8X":r[n].push(f(t.substr(e+8)));break;case"VP8 ":case"VP8L":r[n].push(t.substr(e+8));break;default:console.error(`not supported webp version: '${o}'`)}e=t.length}else r[n].push(t.substr(e+4)),e=t.length}return r}function l(t){return"undefined"!=typeof atob?atob(t):Buffer.from(t,"base64").toString("binary")}const m=(t,e)=>new Promise(((r,n)=>{const o=new Image;o.src=t,o.onload=()=>{const t=document.createElement("canvas"),n=t.getContext("2d");t.width=e?.width||o.width,t.height=e?.height||o.height,n.fillStyle=e?.backgroundColor||"#000",n.fillRect(0,0,t.width,t.height),n?.drawImage(o,0,0,o.width,o.height,0,0,t.width,t.height);const a=t.toDataURL("image/webp");r(a)},o.onerror=t=>{n(t)}})),g={fromImageArray(t,e,r){const n="undefined"==typeof Blob||r,o=e||1;return d(t.map(((t,e)=>{try{return{...c(h(l(t.slice(23)))),duration:1e3/o}}catch(t){throw console.error(`Before toWebM Error, Image Index ${e}`),t}})),n)},fromImageArrayWithOptions(t,e={}){const{fps:r,duration:n,outputAsArray:o}=e;let a=r||1;return n&&(a=1e3/(1e3*n/t.length)),this.fromImageArray(t,a,o)},async fixImageDataList(t,e){const r=[];for(const n of t){const t=await m(n,e);r.push(t)}return r}};function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function y(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?y(Object(r),!0).forEach((function(e){var n,o,a,i;n=t,o=e,a=r[e],i=function(t,e){if("object"!=p(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(o),(o="symbol"==p(i)?i:String(i))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}console.warn("Applying whammy patch"),g.modifiedFromImageArray=function(t,e,r){var n="undefined"==typeof Blob,o=e||1;return d(t.map((function(t,e){r(e);try{return b(b({},c(h(l(t.slice(23))))),{},{duration:1e3/o})}catch(t){throw console.error(t),new Error("Before toWebM Error, Image Index ".concat(e))}})),n)};var w=function(){return g};console.warn("Loading whammy worker"),onmessage=async t=>{const{images:e,fps:r,updateProgress:n}=t.data;console.warn("Whammy worker running!",e,r,w().fromImageArray);const o=w().modifiedFromImageArray(e,r,(t=>{postMessage({type:"Progress",value:t})}));postMessage({type:"Result",value:o})}})();
//# sourceMappingURL=bundle.worker.js.map